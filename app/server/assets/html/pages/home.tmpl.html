{{define "title"}}Home{{end}}

{{define "main"}}

<div class="card" id="form-card">
    <div class="card-header">
        <div class="card-title-row">
            <h2 class="card-title">Create a Secure Message</h2>
            {{if .FilesEnabled}}
            <div class="mode-toggle">
                <button type="button" class="mode-btn active" id="text-tab" data-action="switch-tab" data-mode="text">Text</button>
                <button type="button" class="mode-btn" id="file-tab" data-action="switch-tab" data-mode="file">File</button>
            </div>
            {{end}}
        </div>
        <p class="card-description">Share sensitive information that self-destructs after being read</p>
    </div>

    <form id="secret-form"
          data-max-file-size="{{.MaxFileSize}}"
          hx-post="/generate-link"
          hx-target="#form-card"
          hx-swap="outerHTML"
          hx-indicator="#form-spinner"
          hx-target-400="#form-card"
          hx-target-401="#popup"
          hx-target-500="#notifications"
          hx-trigger="submit, submitSecretForm from:body">

        <div id="content-input">
            <div id="text-input-container">
                {{template "text-input" .}}
            </div>
            {{if .FilesEnabled}}
            <div id="file-input-container" style="display: none;">
                {{template "file-input" .}}
            </div>
            {{end}}
        </div>

        <div class="form-row two-cols">
            <div class="form-group">
                <label for="pin">
                    <svg class="input-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="16" r="1" fill="currentColor"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    {{if .AllowNoPin}}{{.PinSize}}-digit PIN <span class="optional-hint">(optional)</span>{{else}}Create {{.PinSize}}-digit PIN{{end}}
                </label>
                <input type="text"
                       name="pin"
                       id="pin"
                       class="pin-input {{if .Form.FieldErrors.pin}}error-input{{end}}"
                       {{if not .AllowNoPin}}required{{end}}
                       maxlength="{{.PinSize}}"
                       inputmode="numeric"
                       pattern="{{if .AllowNoPin}}|[0-9]{{printf "{%d}" .PinSize}}{{else}}[0-9]{{printf "{%d}" .PinSize}}{{end}}"
                       placeholder="{{range $i := until .PinSize}}{{add $i 1}}{{end}}"
                       title="{{if .AllowNoPin}}PIN is optional or must be exactly {{.PinSize}} digits{{else}}PIN must be exactly {{.PinSize}} digits{{end}}"
                       aria-label="{{.PinSize}}-digit PIN"
                       data-numeric-only />
                {{with .Form.FieldErrors.pin}}
                <span class='error'>{{.}}</span>
                {{end}}
            </div>

            <div class="form-group">
                <label for="exp">
                    Expire in
                    <span class="tooltip">
                        <svg class="tooltip-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M9.09 9C9.3251 8.33167 9.78915 7.76811 10.4 7.40913C11.0108 7.05016 11.7289 6.91894 12.4272 7.03871C13.1255 7.15849 13.7588 7.52152 14.2151 8.06353C14.6713 8.60553 14.9211 9.29152 14.92 10C14.92 12 11.92 13 11.92 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 17H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="tooltip-text">{{if .Form.MaxExp}}Maximum: {{.Form.MaxExp}}{{else}}Set expiration time for automatic deletion{{end}}</span>
                    </span>
                </label>
                <div class="expire-container">
                    <input type="number"
                           name="exp"
                           id="exp"
                           required
                           min="1"
                           value="{{.Form.Exp}}"
                           {{if .Form.FieldErrors.exp}}class="error-input" data-clear-expire-errors{{end}} />

                    <select name="expUnit" id="expUnit" aria-label="Time unit"
                            {{if .Form.FieldErrors.expUnit}}class="error-input"{{end}}
                            {{if or .Form.FieldErrors.exp .Form.FieldErrors.expUnit}}data-clear-expire-errors{{end}}>
                        <option value="m" {{if eq .Form.ExpUnit "m"}}selected{{end}}>minutes</option>
                        <option value="h" {{if eq .Form.ExpUnit "h"}}selected{{end}}>hours</option>
                        <option value="d" {{if eq .Form.ExpUnit "d"}}selected{{end}}>days</option>
                    </select>
                </div>
                {{with .Form.FieldErrors.exp}}
                <span class='error'>{{.}}</span>
                {{end}}
                {{with .Form.FieldErrors.expUnit}}
                <span class='error'>{{.}}</span>
                {{end}}
            </div>
        </div>

        <div id="form-errors"></div>

        <button type="submit" class="main-btn">
            <span class="htmx-indicator" id="form-spinner">
                <svg class="spinner-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Generating...
            </span>
            <span class="button-text">
                <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" stroke="currentColor" stroke-width="2"/>
                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" stroke="currentColor" stroke-width="2"/>
                </svg>
                Generate Secure Link
            </span>
        </button>
    </form>
</div>

{{template "no-pin-modal" .}}

{{end}}

{{define "text-input"}}
<div class="form-group">
    <label for="message">
        <svg class="input-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/>
            <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
            <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2"/>
            <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2"/>
            <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2"/>
        </svg>
        Enter text for sharing
    </label>
    <textarea name="message" id="message" class="content-input-area"
              placeholder="Type or paste your confidential message here..."
              autofocus
              {{if .Form.FieldErrors.message}}class="error-input"{{end}}>{{.Form.Message}}</textarea>
    {{with .Form.FieldErrors.message}}
    <span class='error'>{{.}}</span>
    {{end}}
</div>
{{end}}

{{define "file-input"}}
<div class="form-group">
    <label>
        <svg class="input-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2"/>
            <polyline points="17 8 12 3 7 8" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="3" x2="12" y2="15" stroke="currentColor" stroke-width="2"/>
        </svg>
        Upload file
    </label>
    <div id="drop-zone" class="drop-zone content-input-area" data-action="trigger-file-input">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="1.5"/>
            <polyline points="17 8 12 3 7 8" stroke="currentColor" stroke-width="1.5"/>
            <line x1="12" y1="3" x2="12" y2="15" stroke="currentColor" stroke-width="1.5"/>
        </svg>
        <p>Drop file here or click to browse</p>
        <p id="file-info" class="file-info" style="display:none"></p>
    </div>
    <input type="file" id="file" name="file" style="display:none" />
</div>
{{end}}
