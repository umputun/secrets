{{define "base"}}
    <!DOCTYPE html>
    <html lang="en" {{if ne .Theme "auto"}}data-theme="{{.Theme}}"{{end}}>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>{{if .PageTitle}}{{.PageTitle}}{{else}}{{template "title" .}} - {{.Branding}}{{end}}</title>
        <meta name="description" content="{{if .PageDesc}}{{.PageDesc}}{{else}}Share sensitive information securely with self-destructing messages protected by PIN codes. Free, open-source, and privacy-focused password sharing.{{end}}">
        <meta name="keywords" content="password sharing, secure messaging, encrypted messages, self-destructing messages, PIN protection, secret sharing, sensitive information, privacy, security">
        <meta name="author" content="Umputun">
        <meta name="robots" content="{{if .IsMessagePage}}noindex, nofollow{{else}}index, follow{{end}}">
        
        <!-- Canonical URL -->
        <link rel="canonical" href="{{.URL}}">
        
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="{{.URL}}">
        <meta property="og:title" content="{{if .PageTitle}}{{.PageTitle}}{{else}}{{template "title" .}} - {{.Branding}}{{end}}">
        <meta property="og:description" content="{{if .PageDesc}}{{.PageDesc}}{{else}}Share sensitive information securely with self-destructing messages protected by PIN codes.{{end}}">
        <meta property="og:image" content="{{.BaseURL}}/static/img/logo-social.png">
        <meta property="og:image:width" content="1200">
        <meta property="og:image:height" content="630">
        <meta property="og:site_name" content="{{.Branding}}">
        
        <!-- Twitter -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:url" content="{{.URL}}">
        <meta name="twitter:title" content="{{if .PageTitle}}{{.PageTitle}}{{else}}{{template "title" .}} - {{.Branding}}{{end}}">
        <meta name="twitter:description" content="{{if .PageDesc}}{{.PageDesc}}{{else}}Share sensitive information securely with self-destructing messages protected by PIN codes.{{end}}">
        <meta name="twitter:image" content="{{.BaseURL}}/static/img/logo-social.png">
        
        <!-- Favicons -->
        <link rel='shortcut icon' href='/static/img/favicon.ico' type='image/x-icon'>
        <link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicon-16x16.png">
        <meta name="theme-color" content="#1a1a1a">
        
        <!-- Preconnect for performance -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        
        <!-- Stylesheets -->
        <link rel='stylesheet' href='/static/css/main.css'>
        
        <!-- Structured Data JSON-LD -->
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebApplication",
            "name": "{{jsonEscape .Branding}}",
            "url": "{{jsonEscape .URL}}",
            "description": "{{if .PageDesc}}{{jsonEscape .PageDesc}}{{else}}{{jsonEscape "Share sensitive information securely with self-destructing messages protected by PIN codes."}}{{end}}",
            "applicationCategory": "SecurityApplication",
            "operatingSystem": "Any",
            "offers": {
                "@type": "Offer",
                "price": "0",
                "priceCurrency": "USD"
            },
            "author": {
                "@type": "Person",
                "name": "Umputun",
                "url": "https://github.com/umputun"
            }
        }
        </script>
    </head>
    <body hx-boost="true" hx-ext="response-targets">
    <div id="notifications" class="toast-container"></div>
    <div class="app">
        <button hx-post="/theme" 
                hx-trigger="click"
                id="theme-toggle" 
                class="theme-toggle" 
                aria-label="Toggle theme">
            <svg id="theme-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                {{if eq .Theme "auto"}}
                <!-- auto mode icon -->
                <rect x="5" y="6" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                <path d="M9 19h6M12 16v3" stroke="currentColor" stroke-width="2"/>
                {{else if eq .Theme "dark"}}
                <!-- sun icon (shown in dark mode, click to go light) -->
                <circle cx="12" cy="12" r="4" fill="currentColor"/>
                <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M17.66 6.34l1.41-1.41" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                {{else}}
                <!-- moon icon (shown in light mode, click to go dark) -->
                <path d="M20 11.5C19.25 12.3 18.2 12.9 17 12.9C14.5 12.9 12.5 10.9 12.5 8.4C12.5 7.2 13 6.15 13.8 5.4C13.7 5.4 13.6 5.4 13.5 5.4C9.9 5.4 7 8.3 7 11.9S9.9 18.4 13.5 18.4S20 15.5 20 11.9C20 11.8 20 11.65 20 11.5Z" fill="currentColor" transform="translate(-1, 0)"/>
                {{end}}
            </svg>
        </button>
        
        <div class="app-container">
            <div class="logo-title">
                <a href='/' class="logo-link">
                    <span class="app-name">{{.Branding}}</span>
                </a>
            </div>

            <main class="main-content">
                {{template "main" .}}
            </main>

            <div class="app-footer">
                <a href="/about" class="footer-link">How it works</a>
                <span class="separator">•</span>
                <a href="https://github.com/umputun/secrets" class="footer-link">Source code</a>
                <span class="separator">•</span>
                <span class="copyright">© Umputun, {{.CurrentYear}}</span>
            </div>
        </div>
    </div>

    <div id="popup" class="popup"></div>

    <script src="https://unpkg.com/htmx.org@2.0.3" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/htmx-ext-response-targets@2.0.1/response-targets.js"></script>
    <script>
        // handle popup events  
        document.body.addEventListener('closePopup', function(evt) {
            htmx.ajax('GET', '/close-popup', {target: '#popup', swap: 'outerHTML'});
        });
        
        // handle backdrop clicks on popup
        document.body.addEventListener('click', function(evt) {
            const popup = evt.target.closest('#popup');
            if (popup && evt.target === popup) {
                htmx.ajax('GET', '/close-popup', {target: '#popup', swap: 'outerHTML'});
            }
        });
    </script>
    </body>
    </html>
{{end}}